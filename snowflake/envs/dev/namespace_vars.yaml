IAM:
  role_name: "S3ToStorage_integration"
# TODO:大域変数みたいな使い方したくないが、DRY優先とするならrootにおく？ファイル名namespace_vars_dev.yamlとかにしてやればよさそう

warehouses:
  - name: "TEST_WAREHOUSES"
    warehouse_size: "XSMALL"
    auto_suspend: 60
    auto_resume: true
    initially_suspended: true

storage_integration:
  name: "TEST_STORAGE_INTEGRATION"
  type: "EXTERNAL_STAGE"
  storage_provider: "S3"
  enabled: true

stage:
  name: "TEST_STAGE"
  database: "TEST_DB"
  schema: "TEST_SCHEMA"
  storage_integration: "TEST_STORAGE_INTEGRATION"
  encryption: "NONE"

file_formats:
  - name: "TEST_FORMAT"
    database: "TEST_DB"
    schema: "TEST_SCHEMA"
    format_type: "CSV"

pipes:
  - name: "TEST_PIPE"
    database: "TEST_DB"
    schema: "TEST_SCHEMA"
    comment: "こっち使うほうがいい？→https://registry.terraform.io/modules/Snowflake-Labs/snowpipe-aws/snowflake/latest#required-parameters"
    auto_ingest: false
    stage_name: "TEST_STAGE"
    target_table: "TEST_TABLE"
    sql_file_name: "copy_statement.sql"
    target_format_name: "TEST_FORMAT"

databases:
  - name: "TEST_DB"
    schemas:
      - "TEST_SCHEMA"
      - "TEST_SCHEMA2"

tables:
  - name: "TEST_TABLE"
    database: "TEST_DB"
    schema: "TEST_SCHEMA"
    column: 
      - name: "A"
        type: "string"
      - name: "B"
        type: "string"

# TODO:ユーザ、ロール系切り離してもいいかも
users:
  - name: "ANALYST1"
  - name: "DEV1"
  - name: "DEV2"

rsa_user:
  - name: "AIRFLOW"
    login_name:  "Aiflow"
    rsa_public_key: "rsa_key.pub"
    default_role: "AIRFLOW"
    default_warehouse: "TEST_WAREHOUSES"
    default_namespace: "TEST_DB.TEST_SCHEMA"
# rsa_public_keyはrootにある想定。場所帰るなら相対パスにすれば行けると思う。
# https://docs.snowflake.com/ja/user-guide/key-pair-auth

database_grants:
  - database_role_name: "DB_READ_ROLE"
    database_name: "TEST_DB"
    comment: "test"
    in_schema: "TEST_SCHEMA"
    object_privileges: 
      TABLES:
        - SELECT
  - database_role_name: "AIRFLOW_EXECUTE_PIPE"
    database_name: "TEST_DB"
    comment: "Airflow_execute_pipe"
    in_schema: "TEST_SCHEMA"
    object_privileges: 
      TABLES:
        - SELECT
        - INSERT
      STAGES:
        - USAGE # 外部ステージ(S3)のため

grants_ownership:
  - object_type: "PIPE"
    object_name: "TEST_DB.TEST_SCHEMA.TEST_PIPE"
    account_role_name: "AIRFLOW"

account_roles:
  - name: "ANALYST_ROLE"
    comment: "test comment"
    grants_database_roles:
      - database: "TEST_DB"
        names:
        - "DB_READ_ROLE"
  - name: "AIRFLOW"
    comment: "Airflow only"
    grants_database_roles:
      - database: "TEST_DB"
        names:
        - "AIRFLOW_EXECUTE_PIPE"